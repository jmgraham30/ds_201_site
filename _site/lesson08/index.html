<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="JMG">

<title>Lesson 8 – DS 201</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-b758ccaa5987ceb1b75504551e579abf.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-1ac49dc45d461ba7e3f4755605d38e4c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-482c505b42a27fe86bbc845866694eac.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../site_libs/bootstrap/bootstrap-1ac49dc45d461ba7e3f4755605d38e4c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="../styles.css">
</head>

<body class="floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">DS 201</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../links.html"> 
<span class="menu-text">Links</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jmgraham30/ds_201_site"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link active" data-scroll-target="#learning-objectives">Learning Objectives</a></li>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#the-tidymodels-machine-learning-workflow" id="toc-the-tidymodels-machine-learning-workflow" class="nav-link" data-scroll-target="#the-tidymodels-machine-learning-workflow">The <code>tidymodels</code> Machine Learning Workflow</a>
  <ul class="collapse">
  <li><a href="#tidymodels-family-of-packages" id="toc-tidymodels-family-of-packages" class="nav-link" data-scroll-target="#tidymodels-family-of-packages"><code>tidymodels</code> Family of Packages</a></li>
  <li><a href="#basic-models" id="toc-basic-models" class="nav-link" data-scroll-target="#basic-models">Basic Models</a></li>
  </ul></li>
  <li><a href="#some-examples" id="toc-some-examples" class="nav-link" data-scroll-target="#some-examples"><svg viewbox="0 0 581 512" style="position:relative;display:inline-block;top:.1em;fill:steelblue;height:2em;" xmlns="http://www.w3.org/2000/svg"> <path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"></path></svg> Some Examples</a>
  <ul class="collapse">
  <li><a href="#example-1-tidymodels-workflow-for-linear-regression-for-predictive-modeling" id="toc-example-1-tidymodels-workflow-for-linear-regression-for-predictive-modeling" class="nav-link" data-scroll-target="#example-1-tidymodels-workflow-for-linear-regression-for-predictive-modeling">Example 1: <code>tidymodels</code> Workflow for Linear Regression for Predictive Modeling</a></li>
  <li><a href="#example-2-tidymodels-workflow-for-linear-regression-for-inferential-modeling" id="toc-example-2-tidymodels-workflow-for-linear-regression-for-inferential-modeling" class="nav-link" data-scroll-target="#example-2-tidymodels-workflow-for-linear-regression-for-inferential-modeling">Example 2: <code>tidymodels</code> Workflow for Linear Regression for Inferential Modeling</a></li>
  <li><a href="#example-3-tidymodels-workflow-for-tuning-random-forest-for-regression" id="toc-example-3-tidymodels-workflow-for-tuning-random-forest-for-regression" class="nav-link" data-scroll-target="#example-3-tidymodels-workflow-for-tuning-random-forest-for-regression">Example 3: <code>tidymodels</code> Workflow for Tuning Random Forest for Regression</a></li>
  <li><a href="#example-4-tidymodels-workflow-for-classification-with-multinomial-logistic-regression" id="toc-example-4-tidymodels-workflow-for-classification-with-multinomial-logistic-regression" class="nav-link" data-scroll-target="#example-4-tidymodels-workflow-for-classification-with-multinomial-logistic-regression">Example 4: <code>tidymodels</code> Workflow for Classification with Multinomial Logistic Regression</a></li>
  </ul></li>
  <li><a href="#case-studies" id="toc-case-studies" class="nav-link" data-scroll-target="#case-studies">Case Studies</a></li>
  <li><a href="#comparing-multiple-modeling-approaches" id="toc-comparing-multiple-modeling-approaches" class="nav-link" data-scroll-target="#comparing-multiple-modeling-approaches">Comparing Multiple Modeling Approaches</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lesson 8</h1>
<p class="subtitle lead">Overview of Tidy Models for Supervised Machine Learning</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>JMG </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="learning-objectives">Learning Objectives</h2>
<p>After this lesson, students will be able to</p>
<ul>
<li>understand and utilize the <code>tidymodels</code> framework for supervised machine learning.</li>
</ul>
</section>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>Machine learning (ML) as we have defined it involves estimating a (mathematical) function and we divide problems into two general types: <em>supervised</em> and <em>unsupervised</em> learning. In supervised learning, we have a set of data that we use to train a model to predict a target variable. In unsupervised learning, we have a set of data that we use to train a model to find patterns in the data. In this chapter, we will focus on supervised learning. Further, we separate supervised learning into two types: <em>regression</em> and <em>classification</em>. In regression, the target variable is continuous. In classification, the target variable is categorical. We also consider two types of applications for machine learning: <em>prediction</em> and <em>inference</em>. In prediction, we are interested in predicting the target variable. In inference, we are interested in understanding the relationship between the target variable and the predictors.</p>
</section>
<section id="the-tidymodels-machine-learning-workflow" class="level2">
<h2 class="anchored" data-anchor-id="the-tidymodels-machine-learning-workflow">The <code>tidymodels</code> Machine Learning Workflow</h2>
<p>The <code>tidymodels</code> framework provides a consistent set of steps for training and evaluating machine learning models. The following is a list of the steps in the <code>tidymodels</code> workflow:</p>
<ol type="1">
<li><strong>Data Preparation:</strong>
<ul>
<li>Load and prepare your data set following tidy data principles.</li>
</ul></li>
<li><strong>Data Splitting:</strong>
<ul>
<li>Use the <code>rsample</code> package to create data splits for training and testing.</li>
</ul></li>
<li><strong>Preprocessing and Feature Engineering:</strong>
<ul>
<li>Define a data preprocessing plan using the <code>recipes</code> package.</li>
<li>Create a “recipe” for data cleaning, transformation, and feature engineering.</li>
</ul></li>
<li><strong>Model Specification:</strong>
<ul>
<li>Specify machine learning models with the <code>parsnip</code> package.</li>
<li>Choose from a variety of models for regression, classification, etc.</li>
</ul></li>
<li><strong>Hyperparameter Tuning:</strong>
<ul>
<li>Utilize the <code>tune</code> package for hyperparameter tuning.</li>
<li>Define a grid of hyperparameters and use resampling methods for evaluation.</li>
</ul></li>
<li><strong>Model Training:</strong>
<ul>
<li>Train models with the specified data splits, preprocessing plan, and hyperparameters.</li>
<li>Use the <code>fit</code> function to train on the training data.</li>
</ul></li>
<li><strong>Model Evaluation:</strong>
<ul>
<li>Assess model performance using the <code>yardstick</code> package.</li>
<li>Calculate relevant evaluation metrics (e.g., accuracy, RMSE).</li>
</ul></li>
<li><strong>Model Selection:</strong>
<ul>
<li>Compare model performance and hyperparameter settings.</li>
<li>Select the best-performing model or create ensembles (e.g., stacking, bagging).</li>
</ul></li>
<li><strong>Model Interpretation and Visualization:</strong>
<ul>
<li>Use the <code>broom</code> package to extract and tidy model results.</li>
<li>Visualize model outputs and interpret results.</li>
</ul></li>
<li><strong>Deployment and Prediction:</strong>
<ul>
<li>Deploy the final model for predictions on new data.</li>
<li>Use the trained model in production environments.</li>
</ul></li>
<li><strong>Documentation and Reproducibility:</strong>
<ul>
<li>Document the entire workflow, including preprocessing, model specifications, tuning, and results.</li>
<li>Ensure reproducibility and transparency.</li>
</ul></li>
<li><strong>Sharing and Collaboration:</strong>
<ul>
<li>Share code and findings with collaborators for reproducibility and collaboration.</li>
</ul></li>
<li><strong>Ongoing Monitoring and Maintenance:</strong>
<ul>
<li>In production, monitor model performance and update models as needed.</li>
</ul></li>
</ol>
<p>The best references for <code>tidymodels</code> are the <a href="https://www.tidymodels.org/">tidymodels.org</a> website and the <a href="https://www.tmwr.org/">Tidy Modeling with R</a> book. The <a href="https://www.tmwr.org/">Tidy Modeling with R</a> book is available for free online and is a great resource for learning the <code>tidymodels</code> framework <span class="citation" data-cites="kuhn2022tidy">(<a href="#ref-kuhn2022tidy" role="doc-biblioref">Kuhn and Silge 2022</a>)</span>. The blog posts by <a href="https://juliasilge.com/">Julia Silge</a> are also a great resource for learning <code>tidymodels</code>. <a href="https://juliasilge.com/">View Silge’s blog</a>.</p>
<section id="tidymodels-family-of-packages" class="level3">
<h3 class="anchored" data-anchor-id="tidymodels-family-of-packages"><code>tidymodels</code> Family of Packages</h3>
<p>The <code>tidymodels</code> package in R is an integrated ecosystem of packages designed to streamline the process of creating, evaluating, and deploying machine learning models while adhering to tidy data principles. The <code>tidymodels</code> framework follows a structured and consistent approach to machine learning, making it easier for data scientists and analysts to work with data and build predictive models. Here’s a brief description of the key components of the <code>tidymodels</code> package:</p>
<ol type="1">
<li><strong><a href="https://www.tidymodels.org/"><code>tidyverse</code> Integration</a>:</strong>
<ul>
<li><em>Description</em>: <code>tidymodels</code> seamlessly integrates with the popular <code>tidyverse</code> suite of packages, allowing for the use of tidy data frames and other tidy tools.</li>
</ul></li>
<li><strong><a href="https://rsample.tidymodels.org/"><code>rsample</code></a>:</strong>
<ul>
<li><em>Description</em>: The <code>rsample</code> package is for resampling and creating data splits, essential for tasks such as cross-validation and bootstrapping.</li>
</ul></li>
<li><strong><a href="https://recipes.tidymodels.org/"><code>recipes</code></a>:</strong>
<ul>
<li><em>Description</em>: The <code>recipes</code> package provides a systematic way to define and preprocess feature engineering steps for your data, creating a “recipe” that includes data preprocessing and variable transformations.</li>
</ul></li>
<li><strong><a href="https://parsnip.tidymodels.org/"><code>parsnip</code></a>:</strong>
<ul>
<li><em>Description</em>: The <code>parsnip</code> package defines a common interface for specifying machine learning models, making it easier to work with different modeling engines.</li>
</ul></li>
<li><strong><a href="https://workflows.tidymodels.org/"><code>workflows</code></a>:</strong>
<ul>
<li><em>Description</em>: The <code>workflows</code> package simplifies the process of building, tuning, and evaluating models by combining models, recipes, and tuning into a unified workflow.</li>
</ul></li>
<li><strong><a href="https://tune.tidymodels.org/"><code>tune</code></a>:</strong>
<ul>
<li><em>Description</em>: The <code>tune</code> package offers tools for hyperparameter tuning, allowing you to optimize model performance by systematically searching for the best hyperparameters.</li>
</ul></li>
<li><strong><a href="https://yardstick.tidymodels.org/"><code>yardstick</code></a>:</strong>
<ul>
<li><em>Description</em>: The <code>yardstick</code> package provides a wide range of functions for model evaluation, including metrics for classification, regression, and survival analysis tasks.</li>
</ul></li>
<li><strong><a href="https://broom.tidymodels.org/"><code>broom</code></a>:</strong>
<ul>
<li><em>Description</em>: The <code>broom</code> package helps tidy up the results of model fits, making it easy to extract coefficients, predictions, and other model-related information in a tidy data format.</li>
</ul></li>
<li><strong>Community and Extensibility:</strong>
<ul>
<li><em>Description</em>: The <code>tidymodels</code> ecosystem has a growing community of users and contributors. It supports the creation of custom modeling engines, extending the framework to new algorithms.</li>
</ul></li>
<li><strong>Reproducibility and Best Practices:</strong>
<ul>
<li><em>Description</em>: <code>tidymodels</code> promotes best practices in machine learning, emphasizing tidy data principles, clear model specification, and reproducibility.</li>
</ul></li>
</ol>
</section>
<section id="basic-models" class="level3">
<h3 class="anchored" data-anchor-id="basic-models">Basic Models</h3>
<p>Here we provide lists of the most common supervised machine learning models. Remember that the choice of the machine learning model depends on the specific problem, the nature of the data, and the trade-off between interpretability and predictive performance. It’s often a good practice to experiment with multiple models and evaluate their performance to select the most suitable one for a given task.</p>
<section id="summary-and-characteristics-of-common-supervised-machine-learning-models" class="level4">
<h4 class="anchored" data-anchor-id="summary-and-characteristics-of-common-supervised-machine-learning-models">Summary and Characteristics of Common Supervised Machine Learning Models</h4>
<ol type="1">
<li><strong><a href="https://en.wikipedia.org/wiki/Linear_regression">Linear Regression</a>:</strong>
<ul>
<li><em>Summary</em>: Linear regression models the relationship between a dependent variable and one or more independent variables by fitting a linear equation to the observed data.</li>
<li><em>Characteristics</em>:
<ul>
<li>Suitable for regression tasks (predicting continuous numeric values).</li>
<li>Assumes a linear relationship between predictors and the target.</li>
<li>Simple and interpretable.</li>
</ul></li>
</ul></li>
<li><strong><a href="https://en.wikipedia.org/wiki/Logistic_regression">Logistic Regression</a>:</strong>
<ul>
<li><em>Summary</em>: Logistic regression is used for binary classification, modeling the probability that an instance belongs to a particular class.</li>
<li><em>Characteristics</em>:
<ul>
<li>Suitable for binary classification tasks.</li>
<li>Uses the logistic function to model probabilities.</li>
<li>Provides probabilities and interpretable coefficients.</li>
</ul></li>
</ul></li>
<li><strong><a href="https://en.wikipedia.org/wiki/Decision_tree">Decision Trees</a>:</strong>
<ul>
<li><em>Summary</em>: Decision trees divide the data into subsets based on the most significant attributes, making them suitable for both classification and regression tasks.</li>
<li><em>Characteristics</em>:
<ul>
<li>Non-linear and can capture complex relationships.</li>
<li>Prone to overfitting but can be regularized.</li>
<li>Easily interpretable.</li>
</ul></li>
</ul></li>
<li><strong><a href="https://en.wikipedia.org/wiki/Random_forest">Random Forest</a>:</strong>
<ul>
<li><em>Summary</em>: Random forests are an ensemble of decision trees that improve predictive accuracy and reduce overfitting.</li>
<li><em>Characteristics</em>:
<ul>
<li>Combines multiple decision trees for better performance.</li>
<li>Handles feature importance and reduces variance.</li>
<li>Works well for classification and regression.</li>
</ul></li>
</ul></li>
<li><strong><a href="https://en.wikipedia.org/wiki/Support_vector_machine">Support Vector Machines (SVM)</a>:</strong>
<ul>
<li><em>Summary</em>: SVMs aim to find a hyperplane that best separates data points into different classes.</li>
<li><em>Characteristics</em>:
<ul>
<li>Effective for binary classification and can be extended to multiclass.</li>
<li>Uses kernel functions for non-linear separations.</li>
<li>Good for high-dimensional data.</li>
</ul></li>
</ul></li>
<li><strong><a href="https://en.wikipedia.org/wiki/K-nearest_neighbors_algorithm">K-Nearest Neighbors (K-NN)</a>:</strong>
<ul>
<li><em>Summary</em>: K-NN assigns a class to a data point based on the majority class among its k-nearest neighbors in feature space.</li>
<li><em>Characteristics</em>:
<ul>
<li>Simple and intuitive.</li>
<li>Can handle both classification and regression.</li>
<li>Sensitive to the choice of k.</li>
</ul></li>
</ul></li>
<li><strong><a href="https://en.wikipedia.org/wiki/Naive_Bayes_classifier">Naive Bayes</a>:</strong>
<ul>
<li><em>Summary</em>: Naive Bayes is a probabilistic classifier based on Bayes’ theorem, assuming that features are conditionally independent.</li>
<li><em>Characteristics</em>:
<ul>
<li>Efficient and suitable for text classification.</li>
<li>Assumes feature independence (naive assumption).</li>
<li>Works well for high-dimensional data.</li>
</ul></li>
</ul></li>
<li><strong><a href="https://en.wikipedia.org/wiki/Gradient_boosting">Gradient Boosting Machines (GBM)</a>:</strong>
<ul>
<li><em>Summary</em>: GBMs build an ensemble of weak learners (usually decision trees) to create a strong predictive model.</li>
<li><em>Characteristics</em>:
<ul>
<li>Combines multiple weak learners for high accuracy.</li>
<li>Handles regression and classification tasks.</li>
<li>Prone to overfitting, but can be regularized.</li>
</ul></li>
</ul></li>
<li><strong><a href="https://en.wikipedia.org/wiki/Artificial_neural_network">Neural Networks (Deep Learning)</a>:</strong>
<ul>
<li><em>Summary</em>: Neural networks, especially deep learning models, are highly flexible and can model complex relationships in data.</li>
<li><em>Characteristics</em>:
<ul>
<li>Extremely powerful for various tasks.</li>
<li>Requires large amounts of data and computational resources.</li>
<li>Interpretability can be a challenge for deep models.</li>
</ul></li>
</ul></li>
<li><strong><a href="https://en.wikipedia.org/wiki/Ensemble_learning">Ensemble Methods</a>:</strong>
<ul>
<li><em>Summary</em>: Ensemble methods combine multiple base models to improve predictive performance.</li>
<li><em>Characteristics</em>:
<ul>
<li>Include bagging (e.g., Random Forest), boosting (e.g., AdaBoost), and stacking.</li>
<li>Often more robust and accurate than individual models.</li>
<li>Handle various types of data and tasks.</li>
</ul></li>
</ul></li>
</ol>
</section>
<section id="model-specifications-using-parsnip" class="level4">
<h4 class="anchored" data-anchor-id="model-specifications-using-parsnip">Model Specifications using <code>parsnip</code></h4>
<p>The <code>parsnip</code> package in the <code>tidymodels</code> family allows one to specify a variety of supervised machine learning models. Here is a list of some of the <code>parsnip</code> models:</p>
<ol type="1">
<li><strong><a href="https://parsnip.tidymodels.org/reference/linear_reg.html"><code>linear_reg</code></a>:</strong>
<ul>
<li><em>Description</em>: Linear Regression Model</li>
<li><em>Type</em>: Regression</li>
<li><em>Documentation</em>: <a href="https://parsnip.tidymodels.org/reference/linear_reg.html">linear_reg Documentation</a></li>
</ul></li>
<li><strong><a href="https://parsnip.tidymodels.org/reference/logistic_reg.html"><code>logistic_reg</code></a>:</strong>
<ul>
<li><em>Description</em>: Logistic Regression Model</li>
<li><em>Type</em>: Classification</li>
<li><em>Documentation</em>: <a href="https://parsnip.tidymodels.org/reference/logistic_reg.html">logistic_reg Documentation</a></li>
</ul></li>
<li><strong><a href="https://parsnip.tidymodels.org/reference/decision_tree.html"><code>decision_tree</code></a>:</strong>
<ul>
<li><em>Description</em>: Decision Tree Model</li>
<li><em>Type</em>: Both (Regression and Classification)</li>
<li><em>Documentation</em>: <a href="https://parsnip.tidymodels.org/reference/decision_tree.html">decision_tree Documentation</a></li>
</ul></li>
<li><strong><a href="https://parsnip.tidymodels.org/reference/rand_forest.html"><code>rand_forest</code></a>:</strong>
<ul>
<li><em>Description</em>: Random Forest Model</li>
<li><em>Type</em>: Both (Regression and Classification)</li>
<li><em>Documentation</em>: <a href="https://parsnip.tidymodels.org/reference/rand_forest.html">rand_forest Documentation</a></li>
</ul></li>
<li><strong><a href="https://parsnip.tidymodels.org/reference/svm_rbf.html"><code>svm_rbf</code></a>:</strong>
<ul>
<li><em>Description</em>: Support Vector Machine with Radial Basis Function Kernel Model</li>
<li><em>Type</em>: Both (Regression and Classification)</li>
<li><em>Documentation</em>: <a href="https://parsnip.tidymodels.org/reference/svm_rbf.html">svm_rbf Documentation</a></li>
</ul></li>
<li><strong><a href="https://parsnip.tidymodels.org/reference/svm_linear.html"><code>svm_linear</code></a>:</strong>
<ul>
<li><em>Description</em>: Support Vector Machine with Linear Kernel Model</li>
<li><em>Type</em>: Both (Regression and Classification)</li>
<li><em>Documentation</em>: <a href="https://parsnip.tidymodels.org/reference/svm_linear.html">svm_linear Documentation</a></li>
</ul></li>
<li><strong><a href="https://parsnip.tidymodels.org/reference/nearest_neighbor.html"><code>nearest_neighbor</code></a>:</strong>
<ul>
<li><em>Description</em>: k-Nearest Neighbors Model</li>
<li><em>Type</em>: Both (Regression and Classification)</li>
<li><em>Documentation</em>: <a href="https://parsnip.tidymodels.org/reference/nearest_neighbor.html">nearest_neighbor Documentation</a></li>
</ul></li>
<li><strong><a href="https://parsnip.tidymodels.org/reference/naive_Bayes.html"><code>naive_Bayes</code></a>:</strong>
<ul>
<li><em>Description</em>: Naive Bayes Model</li>
<li><em>Type</em>: Classification</li>
<li><em>Documentation</em>: <a href="https://parsnip.tidymodels.org/reference/naive_Bayes.html">naive_Bayes Documentation</a></li>
</ul></li>
<li><strong><a href="https://parsnip.tidymodels.org/reference/boost_tree.html"><code>boost_tree</code></a>:</strong>
<ul>
<li><em>Description</em>: Gradient Boosting Model</li>
<li><em>Type</em>: Both (Regression and Classification)</li>
<li><em>Documentation</em>: <a href="https://parsnip.tidymodels.org/reference/boost_tree.html">boost_tree Documentation</a></li>
</ul></li>
<li><strong><a href="https://parsnip.tidymodels.org/reference/mlp.html"><code>mlp</code></a>:</strong>
<ul>
<li><em>Description</em>: Multilayer Perceptron (Neural Network) Model</li>
<li><em>Type</em>: Both (Regression and Classification)</li>
<li><em>Documentation</em>: <a href="https://parsnip.tidymodels.org/reference/mlp.html">mlp Documentation</a></li>
</ul></li>
<li><strong><a href="https://brulee.tidymodels.org/"><code>brulee</code></a>:</strong>
<ul>
<li><em>Description</em>: The R brulee package contains several basic modeling functions that use the torch package infrastructure, such as: linear regression, logistic regression, and neural networks.</li>
<li><em>Type</em>: Both (Regression and Classification)</li>
<li><em>Documentation</em>: <a href="https://brulee.tidymodels.org/">brulee Documentation</a></li>
</ul></li>
</ol>
<p><strong>Note:</strong> Some of the model specifications in <code>parsnip</code> are wrappers for other packages and you will need to have those packages installed for everything to work. Make sure to refer to the the <a href="https://parsnip.tidymodels.org/"><code>parsnip</code> documentation</a>. before fitting models.</p>
</section>
</section>
</section>
<section id="some-examples" class="level2">
<h2 class="anchored" data-anchor-id="some-examples"><svg viewbox="0 0 581 512" style="position:relative;display:inline-block;top:.1em;fill:steelblue;height:2em;" xmlns="http://www.w3.org/2000/svg"> <path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"></path></svg> Some Examples</h2>
<p>We’ve already seen examples of utilizing the <code>tidymodels</code> framework for nearest neighbors, let’s examine some further examples.</p>
<section id="example-1-tidymodels-workflow-for-linear-regression-for-predictive-modeling" class="level3">
<h3 class="anchored" data-anchor-id="example-1-tidymodels-workflow-for-linear-regression-for-predictive-modeling">Example 1: <code>tidymodels</code> Workflow for Linear Regression for Predictive Modeling</h3>
<p>The following is an example of the <code>tidymodels</code> workflow for linear regression for predictive modeling. The example uses the <code>mtcars</code> dataset and the <code>parsnip</code> and <code>recipes</code> packages. The example is adapted from the <a href="https://www.tmwr.org/">Tidy Modeling with R</a> book <span class="citation" data-cites="kuhn2022tidy">(<a href="#ref-kuhn2022tidy" role="doc-biblioref">Kuhn and Silge 2022</a>)</span>.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed for reproducibility</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load the mtcars dataset</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create a training and testing split</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>mtcars_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(mtcars, <span class="at">prop =</span> <span class="fl">0.75</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create a training and testing dataset</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>mtcars_train <span class="ot">&lt;-</span> <span class="fu">training</span>(mtcars_split)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>mtcars_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(mtcars_split)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># create a recipe for preprocessing</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>mtcars_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(mpg <span class="sc">~</span> ., <span class="at">data =</span> mtcars_train) <span class="sc">%&gt;%</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_center</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_scale</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># create a linear regression model</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>lm_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the model</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>lm_fit <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(mtcars_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_spec) <span class="sc">%&gt;%</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> mtcars_train)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co"># make predictions</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>lm_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_fit, mtcars_test) <span class="sc">%&gt;%</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(mtcars_test)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co"># evaluate the model</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>lm_eval <span class="ot">&lt;-</span> lm_pred <span class="sc">%&gt;%</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">metrics</span>(<span class="at">truth =</span> mpg, <span class="at">estimate =</span> .pred) <span class="sc">%&gt;%</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    lm_pred <span class="sc">%&gt;%</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rsq</span>(<span class="at">truth =</span> mpg, <span class="at">estimate =</span> .pred) <span class="sc">%&gt;%</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">metric =</span> <span class="st">"rsq"</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy the model results</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>lm_tidy <span class="ot">&lt;-</span> <span class="fu">tidy</span>(lm_fit)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize the model results</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>lm_tidy <span class="sc">%&gt;%</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> estimate)) <span class="sc">+</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> estimate <span class="sc">-</span> std.error, <span class="at">ymax =</span> estimate <span class="sc">+</span> std.error)) <span class="sc">+</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Linear Regression Model Results"</span>,</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Model: mpg ~ ."</span>,</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Term"</span>,</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Estimate"</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-tidy-models-workflow-lm" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tidy-models-workflow-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-tidy-models-workflow-lm-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tidy-models-workflow-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Tidy Models Workflow for Regression
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div id="tbl-lm-results" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-lm-results-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Linear Regression Model Results
</figcaption>
<div aria-describedby="tbl-lm-results-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:100%; ">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">term</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">estimate</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">std.error</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">statistic</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">21.0708333</td>
<td style="text-align: right;">0.6035556</td>
<td style="text-align: right;">34.9111701</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">cyl</td>
<td style="text-align: right;">-1.8085954</td>
<td style="text-align: right;">2.7450923</td>
<td style="text-align: right;">-0.6588469</td>
<td style="text-align: right;">0.5214933</td>
</tr>
<tr class="odd">
<td style="text-align: left;">disp</td>
<td style="text-align: right;">2.7886147</td>
<td style="text-align: right;">3.3586784</td>
<td style="text-align: right;">0.8302714</td>
<td style="text-align: right;">0.4213717</td>
</tr>
<tr class="even">
<td style="text-align: left;">hp</td>
<td style="text-align: right;">-1.4572830</td>
<td style="text-align: right;">2.4512678</td>
<td style="text-align: right;">-0.5945018</td>
<td style="text-align: right;">0.5623810</td>
</tr>
<tr class="odd">
<td style="text-align: left;">drat</td>
<td style="text-align: right;">0.0941833</td>
<td style="text-align: right;">1.1813897</td>
<td style="text-align: right;">0.0797225</td>
<td style="text-align: right;">0.9376722</td>
</tr>
<tr class="even">
<td style="text-align: left;">wt</td>
<td style="text-align: right;">-4.4737683</td>
<td style="text-align: right;">2.3983919</td>
<td style="text-align: right;">-1.8653200</td>
<td style="text-align: right;">0.0848621</td>
</tr>
<tr class="odd">
<td style="text-align: left;">qsec</td>
<td style="text-align: right;">1.6098052</td>
<td style="text-align: right;">1.7188679</td>
<td style="text-align: right;">0.9365497</td>
<td style="text-align: right;">0.3660636</td>
</tr>
<tr class="even">
<td style="text-align: left;">vs</td>
<td style="text-align: right;">0.4021956</td>
<td style="text-align: right;">1.3188879</td>
<td style="text-align: right;">0.3049506</td>
<td style="text-align: right;">0.7652312</td>
</tr>
<tr class="odd">
<td style="text-align: left;">am</td>
<td style="text-align: right;">1.2501668</td>
<td style="text-align: right;">1.4919647</td>
<td style="text-align: right;">0.8379332</td>
<td style="text-align: right;">0.4172084</td>
</tr>
<tr class="even">
<td style="text-align: left;">gear</td>
<td style="text-align: right;">-0.0667576</td>
<td style="text-align: right;">1.5665234</td>
<td style="text-align: right;">-0.0426151</td>
<td style="text-align: right;">0.9666559</td>
</tr>
<tr class="odd">
<td style="text-align: left;">carb</td>
<td style="text-align: right;">0.5220534</td>
<td style="text-align: right;">1.8506869</td>
<td style="text-align: right;">0.2820863</td>
<td style="text-align: right;">0.7823182</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div id="tbl-lm-eval" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-lm-eval-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Linear Regression Model Evaluation
</figcaption>
<div aria-describedby="tbl-lm-eval-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:100%; ">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">.metric</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">.estimator</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">.estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">rmse</td>
<td style="text-align: left;">standard</td>
<td style="text-align: right;">2.4214858</td>
</tr>
<tr class="even">
<td style="text-align: left;">rsq</td>
<td style="text-align: left;">standard</td>
<td style="text-align: right;">0.7487043</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mae</td>
<td style="text-align: left;">standard</td>
<td style="text-align: right;">2.0481386</td>
</tr>
<tr class="even">
<td style="text-align: left;">rsq</td>
<td style="text-align: left;">standard</td>
<td style="text-align: right;">0.7487043</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="example-2-tidymodels-workflow-for-linear-regression-for-inferential-modeling" class="level3">
<h3 class="anchored" data-anchor-id="example-2-tidymodels-workflow-for-linear-regression-for-inferential-modeling">Example 2: <code>tidymodels</code> Workflow for Linear Regression for Inferential Modeling</h3>
<p>The following is an example of the <code>tidymodels</code> workflow for linear regression for inferential modeling. The example uses the <code>mtcars</code> dataset and the <code>parsnip</code> and <code>recipes</code> packages.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed for reproducibility</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load the mtcars dataset</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create bootstrap samples</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>mtcars_boot <span class="ot">&lt;-</span> <span class="fu">reg_intervals</span>(mpg <span class="sc">~</span> disp <span class="sc">+</span> cyl <span class="sc">+</span> wt <span class="sc">+</span> am, </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>                             <span class="at">data =</span> mtcars,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                             <span class="at">model_fn =</span> <span class="st">"lm"</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>                             <span class="at">type =</span> <span class="st">"percentile"</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                             <span class="at">keep_reps =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>mtcars_boot <span class="sc">%&gt;%</span> </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term, .replicates) <span class="sc">%&gt;%</span> </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> .replicates) <span class="sc">%&gt;%</span> </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate)) <span class="sc">+</span> </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>,<span class="at">color=</span><span class="st">"white"</span>,<span class="at">fill=</span><span class="st">"lightblue"</span>) <span class="sc">+</span> </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> term, <span class="at">scales =</span> <span class="st">"free_x"</span>) <span class="sc">+</span> </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> mtcars_boot, <span class="fu">aes</span>(<span class="at">xintercept =</span> .lower), <span class="at">col =</span> <span class="st">"purple"</span>) <span class="sc">+</span> </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> mtcars_boot, <span class="fu">aes</span>(<span class="at">xintercept =</span> .upper), <span class="at">col =</span> <span class="st">"purple"</span>) <span class="sc">+</span> </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"black"</span>,<span class="at">linetype=</span><span class="st">"dashed"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-tidy-models-workflow-lm-inferential" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tidy-models-workflow-lm-inferential-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-tidy-models-workflow-lm-inferential-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tidy-models-workflow-lm-inferential-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Tidy Models Workflow for Regression
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="example-3-tidymodels-workflow-for-tuning-random-forest-for-regression" class="level3">
<h3 class="anchored" data-anchor-id="example-3-tidymodels-workflow-for-tuning-random-forest-for-regression">Example 3: <code>tidymodels</code> Workflow for Tuning Random Forest for Regression</h3>
<p>The following is an example of the <code>tidymodels</code> workflow for tuning random forest for regression. The example uses the <code>mtcars</code> dataset and the <code>parsnip</code> and <code>recipes</code> packages.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed for reproducibility</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load the mtcars dataset</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create a training and testing split</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>mtcars_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(mtcars, <span class="at">prop =</span> <span class="fl">0.75</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create a training and testing dataset</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>mtcars_train <span class="ot">&lt;-</span> <span class="fu">training</span>(mtcars_split)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>mtcars_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(mtcars_split)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># create a cross-validation set</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>mtcars_cv <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(mtcars_train, <span class="at">v =</span> <span class="dv">5</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># create a recipe for preprocessing</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>mtcars_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(mpg <span class="sc">~</span> ., <span class="at">data =</span> mtcars_train)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># create a random forest model</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>rf_spec <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="fu">tune</span>(),</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">trees =</span> <span class="dv">1000</span>,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_n =</span> <span class="fu">tune</span>()</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co"># create a workflow</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>tune_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(mtcars_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(rf_spec)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co"># create tuning grid</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>rf_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtry</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">11</span>)),</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">min_n</span>(),</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="dv">15</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="co"># tune the model</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>tune_res <span class="ot">&lt;-</span> <span class="fu">tune_grid</span>(</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  tune_wf,</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">resamples =</span> mtcars_cv,</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid =</span> rf_grid</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize the tuning results</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>tune_res <span class="sc">%&gt;%</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">"rmse"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">min_n =</span> <span class="fu">factor</span>(min_n)) <span class="sc">%&gt;%</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(mtry, mean, <span class="at">color =</span> min_n)) <span class="sc">+</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"RMSE"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-tidy-models-workflow-rf" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tidy-models-workflow-rf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-tidy-models-workflow-rf-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tidy-models-workflow-rf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Tidy Models Workflow for Random Forest
</figcaption>
</figure>
</div>
</div>
</div>
<p>Now we will select a final model based on the tuning results.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>best_rmse <span class="ot">&lt;-</span> <span class="fu">select_best</span>(tune_res, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>final_rf <span class="ot">&lt;-</span> <span class="fu">finalize_model</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  rf_spec,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  best_rmse</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>final_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(mtcars_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(final_rf)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>final_res <span class="ot">&lt;-</span> final_wf <span class="sc">%&gt;%</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(mtcars_split)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>→ A | warning: ! 11 columns were requested but there were 10 predictors in the data.
               ℹ 10 predictors will be used.</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>final_res <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"200px"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:100%; ">
<table class="table caption-top table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">.metric</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">.estimator</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">.estimate</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">.config</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">rmse</td>
<td style="text-align: left;">standard</td>
<td style="text-align: right;">1.9756510</td>
<td style="text-align: left;">pre0_mod0_post0</td>
</tr>
<tr class="even">
<td style="text-align: left;">rsq</td>
<td style="text-align: left;">standard</td>
<td style="text-align: right;">0.7158239</td>
<td style="text-align: left;">pre0_mod0_post0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Let’s see how the model predictions compare with the observed data for the test set observations.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>final_res <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_predictions</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(mpg, .pred)) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">color =</span> <span class="st">"purple"</span>) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Observed"</span>, <span class="at">y =</span> <span class="st">"Predicted"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-tidy-models-workflow-rf-pred" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tidy-models-workflow-rf-pred-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-tidy-models-workflow-rf-pred-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tidy-models-workflow-rf-pred-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Results on Test Set for Tuned Random Forest for Regression
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="example-4-tidymodels-workflow-for-classification-with-multinomial-logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="example-4-tidymodels-workflow-for-classification-with-multinomial-logistic-regression">Example 4: <code>tidymodels</code> Workflow for Classification with Multinomial Logistic Regression</h3>
<p>The following is an example of the <code>tidymodels</code> workflow for multinomial logistic regression. The example uses the <code>penguins</code> dataset and the <code>parsnip</code> and <code>recipes</code> packages.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed for reproducibility</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load the penguins dataset</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(penguins)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># remove missing values from the dataset</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>penguins <span class="ot">&lt;-</span> penguins <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>()</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create a training and testing split</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>penguins_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(penguins, <span class="at">prop =</span> <span class="fl">0.75</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co"># create a training and testing dataset</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>penguins_train <span class="ot">&lt;-</span> <span class="fu">training</span>(penguins_split)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>penguins_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(penguins_split)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co"># create a cross-validation set</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>penguins_cv <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(penguins_train, <span class="at">v =</span> <span class="dv">5</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co"># create a recipe for preprocessing</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>penguins_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(island <span class="sc">~</span> bill_length_mm <span class="sc">+</span> bill_depth_mm <span class="sc">+</span> flipper_length_mm <span class="sc">+</span> body_mass_g, <span class="at">data =</span> penguins_train)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co"># create a multinomial logistic regression model</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>logit_spec <span class="ot">&lt;-</span> <span class="fu">multinom_reg</span>(<span class="at">penalty =</span> <span class="fu">tune</span>(), <span class="at">mixture =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="co"># create a workflow</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>nber_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>(penguins_recipe, logit_spec)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="co"># create grid for tuning</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>nber_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">penalty</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">0</span>)), </span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">mixture</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)),</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="dv">20</span>)</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="co"># tune the model</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>nber_rs <span class="ot">&lt;-</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    nber_wf,</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    penguins_cv,</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid =</span> nber_grid</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(nber_rs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-tidy-models-workflow-logit" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tidy-models-workflow-logit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-tidy-models-workflow-logit-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tidy-models-workflow-logit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Tidy Models Workflow for Multinomial Logistic Regression
</figcaption>
</figure>
</div>
</div>
</div>
<p>Show best models.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show_best</span>(nber_rs) <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"200px"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:100%; ">
<table class="table caption-top table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">penalty</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">mixture</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">.metric</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">.estimator</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">mean</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">n</th>
<th data-quarto-table-cell-role="th" style="text-align: right; position: sticky; top: 0; background-color: #FFFFFF;">std_err</th>
<th data-quarto-table-cell-role="th" style="text-align: left; position: sticky; top: 0; background-color: #FFFFFF;">.config</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1.00e-05</td>
<td style="text-align: right;">0.4210526</td>
<td style="text-align: left;">roc_auc</td>
<td style="text-align: left;">hand_till</td>
<td style="text-align: right;">0.8596058</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.0076867</td>
<td style="text-align: left;">pre0_mod009_post0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.00e-05</td>
<td style="text-align: right;">0.4736842</td>
<td style="text-align: left;">roc_auc</td>
<td style="text-align: left;">hand_till</td>
<td style="text-align: right;">0.8596058</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.0076867</td>
<td style="text-align: left;">pre0_mod010_post0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1.00e-05</td>
<td style="text-align: right;">0.5789474</td>
<td style="text-align: left;">roc_auc</td>
<td style="text-align: left;">hand_till</td>
<td style="text-align: right;">0.8596058</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.0076867</td>
<td style="text-align: left;">pre0_mod012_post0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.83e-05</td>
<td style="text-align: right;">0.4210526</td>
<td style="text-align: left;">roc_auc</td>
<td style="text-align: left;">hand_till</td>
<td style="text-align: right;">0.8596058</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.0076867</td>
<td style="text-align: left;">pre0_mod029_post0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1.83e-05</td>
<td style="text-align: right;">0.4736842</td>
<td style="text-align: left;">roc_auc</td>
<td style="text-align: left;">hand_till</td>
<td style="text-align: right;">0.8596058</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.0076867</td>
<td style="text-align: left;">pre0_mod030_post0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Select the best model.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>final_penalty <span class="ot">&lt;-</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  nber_rs <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_by_one_std_err</span>(<span class="at">metric =</span> <span class="st">"roc_auc"</span>, <span class="fu">desc</span>(penalty))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Fit the final model.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>final_rs <span class="ot">&lt;-</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  nber_wf <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(final_penalty) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(penguins_split)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>The confusion matrix for the final model prdictions on the test set.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_predictions</span>(final_rs) <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(island, .pred_class) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-tidy-models-workflow-logit-confusion" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tidy-models-workflow-logit-confusion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-tidy-models-workflow-logit-confusion-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tidy-models-workflow-logit-confusion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Confusion Matrix for Final Model Predictions on Test Set
</figcaption>
</figure>
</div>
</div>
</div>
<p>The ROC curve.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show the code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_predictions</span>(final_rs) <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(<span class="at">truth =</span> island, .pred_Biscoe<span class="sc">:</span>.pred_Torgersen) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="dv">1</span> <span class="sc">-</span> specificity, sensitivity, <span class="at">color =</span> .level)) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"gray50"</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-tidy-models-workflow-logit-roc" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-tidy-models-workflow-logit-roc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-tidy-models-workflow-logit-roc-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-tidy-models-workflow-logit-roc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: ROC Curve for Final Model Predictions on Test Set
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="case-studies" class="level2">
<h2 class="anchored" data-anchor-id="case-studies">Case Studies</h2>
<p>Let’s see how the <code>tidymodels</code> workflow can be used in a case study. View one or more of the following blog posts by the data scientist <a href="https://juliasilge.com/">Julia Silge</a>.</p>
<ul>
<li><p><a href="https://juliasilge.com/blog/palmer-penguins/">Get started with <code>tidymodels</code> Palmer penguins</a></p></li>
<li><p><a href="https://juliasilge.com/blog/bird-baths/">Fit and predict with tidymodels for bird baths in Australia</a></p></li>
<li><p><a href="https://juliasilge.com/blog/wind-turbine/">Tune and interpret decision trees for wind turbines</a></p></li>
<li><p><a href="https://juliasilge.com/blog/scooby-doo/">Predict which Scooby Doo monsters are REAL with a tuned decision tree model</a></p></li>
<li><p><a href="https://juliasilge.com/blog/ncaa-tuning/">Modeling NCAA women’s basketball tournament seeds</a></p></li>
<li><p><a href="https://juliasilge.com/blog/tate-collection/">Explore art media over time in the Tate collection dataset</a></p></li>
<li><p><a href="https://juliasilge.com/blog/chicago-traffic-model/">Predicting injuries for Chicago traffic crashes</a></p></li>
<li><p><a href="https://juliasilge.com/blog/ikea-prices/">Tune random forests for IKEA prices</a></p></li>
<li><p><a href="https://juliasilge.com/blog/nber-papers/">Multiclass predictive modeling for NBER papers</a></p></li>
<li><p><a href="https://juliasilge.com/blog/superbowl-conf-int/">Bootstrap confidence intervals for Super Bowl commercials</a></p></li>
<li><p><a href="https://juliasilge.com/blog/art-history/">Resampling to understand gender in art history data</a></p></li>
<li><p><a href="https://juliasilge.com/blog/water-sources/">Predict availability in water sources with random forest models</a></p></li>
<li><p><a href="https://juliasilge.com/blog/ceo-departures/">Estimate change in CEO departures with bootstrap resampling</a></p></li>
<li><p><a href="https://juliasilge.com/blog/astronaut-missions-bagging/">Bagging with tidymodels and astronaut missions</a></p></li>
<li><p><a href="https://juliasilge.com/blog/austin-housing/">Predict housing prices in Austin TX with <code>tidymodels</code> and <code>xgboost</code></a></p></li>
<li><p><a href="https://juliasilge.com/blog/datasaurus-multiclass/">Predicting class membership for the Datasaurus Dozen</a></p></li>
<li><p><a href="https://juliasilge.com/blog/haunted-places/">Where are haunted cemeteries compared to haunted schools?</a></p></li>
</ul>
</section>
<section id="comparing-multiple-modeling-approaches" class="level2">
<h2 class="anchored" data-anchor-id="comparing-multiple-modeling-approaches">Comparing Multiple Modeling Approaches</h2>
<p>In her blog post <a href="https://juliasilge.com/blog/spam-email/">Evaluate multiple modeling approaches for spam email</a>, Julia Silge uses workflow sets to evaluate multiple possible models. Let’s work through that post together. <a href="https://juliasilge.com/blog/spam-email/">View the post</a>.</p>
<p>Some other posts that give examples of comparing many different models are <a href="https://juliasilge.com/blog/crop-yields/">Train and analyze many models for crop yields</a> and <a href="https://juliasilge.com/blog/giant-pumpkins/">Predict giant pumpkin weights with workflowsets</a>.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-kuhn2022tidy" class="csl-entry" role="listitem">
Kuhn, Max, and Julia Silge. 2022. <em>Tidy Modeling with r</em>. " O’Reilly Media, Inc.".
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Expand for Session Info
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.5.2 (2025-10-31)
 os       macOS Tahoe 26.1
 system   aarch64, darwin20
 ui       X11
 language (EN)
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       America/New_York
 date     2025-11-28
 pandoc   3.6.3 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/aarch64/ (via rmarkdown)
 quarto   1.8.26 @ /Applications/quarto/bin/quarto

─ Packages ───────────────────────────────────────────────────────────────────
 package      * version date (UTC) lib source
 broom        * 1.0.10  2025-09-13 [1] CRAN (R 4.5.0)
 dials        * 1.4.2   2025-09-04 [1] CRAN (R 4.5.0)
 dplyr        * 1.1.4   2023-11-17 [1] CRAN (R 4.5.0)
 forcats      * 1.0.1   2025-09-25 [1] CRAN (R 4.5.0)
 ggplot2      * 4.0.1   2025-11-14 [1] CRAN (R 4.5.2)
 ggthemes     * 5.1.0   2024-02-10 [1] CRAN (R 4.5.0)
 infer        * 1.0.9   2025-06-26 [1] CRAN (R 4.5.0)
 ISLR2        * 1.3-2   2022-11-20 [1] CRAN (R 4.5.0)
 kableExtra   * 1.4.0   2024-01-24 [1] CRAN (R 4.5.0)
 lubridate    * 1.9.4   2024-12-08 [1] CRAN (R 4.5.0)
 modeldata    * 1.5.1   2025-08-22 [1] CRAN (R 4.5.0)
 parsnip      * 1.3.3   2025-08-31 [1] CRAN (R 4.5.0)
 parttree     * 0.1.1   2025-05-10 [1] CRAN (R 4.5.0)
 purrr        * 1.2.0   2025-11-04 [1] CRAN (R 4.5.0)
 readr        * 2.1.6   2025-11-14 [1] CRAN (R 4.5.2)
 recipes      * 1.3.1   2025-05-21 [1] CRAN (R 4.5.0)
 rsample      * 1.3.1   2025-07-29 [1] CRAN (R 4.5.0)
 scales       * 1.4.0   2025-04-24 [1] CRAN (R 4.5.0)
 sessioninfo  * 1.2.3   2025-02-05 [1] CRAN (R 4.5.0)
 stringr      * 1.6.0   2025-11-04 [1] CRAN (R 4.5.0)
 tailor       * 0.1.0   2025-08-25 [1] CRAN (R 4.5.0)
 tibble       * 3.3.0   2025-06-08 [1] CRAN (R 4.5.0)
 tidymodels   * 1.4.1   2025-09-08 [1] CRAN (R 4.5.0)
 tidyr        * 1.3.1   2024-01-24 [1] CRAN (R 4.5.0)
 tidyverse    * 2.0.0   2023-02-22 [1] CRAN (R 4.5.0)
 tune         * 2.0.1   2025-10-17 [1] CRAN (R 4.5.0)
 vip          * 0.4.1   2023-08-21 [1] CRAN (R 4.5.0)
 workflows    * 1.3.0   2025-08-27 [1] CRAN (R 4.5.0)
 workflowsets * 1.1.1   2025-05-27 [1] CRAN (R 4.5.0)
 yardstick    * 1.3.2   2025-01-22 [1] CRAN (R 4.5.0)

 [1] /Users/r01235571/Library/R/arm64/4.5/library
 [2] /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library
 * ── Packages attached to the search path.

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode"><img src="http://mirrors.creativecommons.org/presskit/buttons/88x31/png/by-nc-sa.png?raw=1" class="img-fluid quarto-figure quarto-figure-left figure-img" style="width:15.0%"></a></p>
</figure>
</div>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>